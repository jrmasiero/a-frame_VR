<!doctype HTML>

<!DBLAB VIRTUAL - DIGITAL TWIN DO NOSSO LABORATIORIO COM DADOS DOS SENSORES>

<html>
<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<!--script src="https://rawgit.com/aframevr/aframe/4f0540b/dist/aframe-master.min.js"></script-->
<script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
  <script src="../js/aframe-mouse-cursor-component.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>

</head>
  <body>
    <a-scene>
      <a-assets>

  <a-asset-item id="dblab" src="../3d/2_0.gltf"></a-asset-item>
<video id="intro" autoplay="true" loop="true" src="../3d/DBLab.webm"></video>
</a-assets>

    <a-entity id="bg" geometry="primitive: plane" material="color: blue"position="0 0 5"
     sound="src: url(../3d/bg_1.mp3); autoplay: false"></a-entity>
<! 0.0 1.2764 -2.094      x 0.98  y 0.57>
  <a-video src="#intro" width="3" height="1.75" scale="0.3 0.3 0.3" position="0.0 1.2764 2.0"></a-video>

      <a-entity laser-controls="hand:  right"></a-entity>
      <a-entity laser-controls raycaster="objects: .clickable; far: 5"></a-entity>




      <a-entity id="room" gltf-model="#dblab"  position="0 0 0"></a-entity>

      <!Teto para baixo>
      <a-light type="directional" position="-2 2 0" rotation="0 0 0" intensity="2.0" target="#directional_0">
      <a-entity id="directional_0" position="2 -1 0"></a-entity>
      </a-light>
      <!Teto para baixo>
      <a-light type="directional" position="2 2 0" rotation="0 0 0" intensity="2.0"target="#directional_1">
        <a-entity id="directional_1" position="-2 -1 0"></a-entity>
      </a-light>
      <!Centro para Parede TV>
      <a-light type="directional" position="0.0 1.0 0.0" rotation="0 0 0" intensity="3.0" target="#directional_2">
        <a-entity id="directional_2" position="0 0 1"></a-entity>
      </a-light>
      <!Centro para Parede Armarinho>
      <a-light type="directional" position="0.0 1.0 0.0" rotation="0 0 0" intensity="3.0" target="#directional_3">
        <a-entity id="directional_3" position="0 0 -1"></a-entity>
      </a-light>
      <!Centro para Teto>
      <a-light type="directional" position="0.0 1.0 0.0" rotation="0 0 0" intensity="3.0" target="#directional_4">
        <a-entity id="directional_4" position="0 2 0"></a-entity>
      </a-light>

      <a-text value="Bem vindo ao DBLab!" color="#0077be"
        position="0.16 0.8 -1.8" scale="0.6 0.6 0.6"></a-text>

        <a-text id="temperatura" value="Temperatura" color="#0077be"
          position="0.16 1.0 -1.8" scale="0.6 0.6 0.6"></a-text>

          <a-text id="umidade" value="Umidade" color="#0077be"
            position="0.16 1.2 -1.8" scale="0.6 0.6 0.6"></a-text>

            <a-text id="distancia" value="Distancia" color="#0077be"
              position="0.16 1.4 -1.8" scale="0.6 0.6 0.6"></a-text>



      <a-sky color="#ECECEC"></a-sky>

      <a-entity id="rig"
          movement-controls
          position="0 1.2 -0.5"
          rotation="0 180 0">
  <a-entity camera


            look-controls="pointerLockEnabled: false; acceleration: 1" ></a-entity>
</a-entity>


  </a-scene>

    <script>


      var targetEl = document.querySelector('#room');
      targetEl.object3D.scale.set(1, 1, 1);

    </script>

    <script>

    var info_temperatura = document.querySelector('#temperatura');
    var info_umidade = document.querySelector('#umidade');
    var info_distancia = document.querySelector('#distancia');
    // Create a client instance
    //client = new Paho.MQTT.Client("177.99.211.82", 30076, "clientId");
    client = new Paho.MQTT.Client("iot.eclipse.org", 443, new Date().toString());

    // set callback handlers
    client.onConnectionLost = onConnectionLost;
    client.onMessageArrived = onMessageArrived;

    var options = {
      useSSL: true,
      timeout: 3,
      onSuccess: onConnect
    }

    // connect the client
    client.connect(options);

    // called when the client connects
    function onConnect() {
      client.subscribe("dblab/hands-on/mqtt/display");
      console.log("data   ", new Date());
    }

    // called when the client loses its connection
    function onConnectionLost(responseObject) {
      if (responseObject.errorCode !== 0) {
        console.log("onConnectionLost:"+responseObject.errorMessage);
      }
    }

    // called when a message arrives
function onMessageArrived(message) {
  message = message.payloadString.toString();
  //console.log("MENSAGEM       ", message);
  if(message[0] == "H"){
    message = message.split('H: ').join('');
    message = message.split('%').join('');
    info_umidade.setAttribute('value', "" + message + "%");
  }else if(message[0] == "T"){
    message = message.split('T: ').join('');
    message = message.split('C').join('');
    info_temperatura.setAttribute('value', "" + message +"C");
  }else if((message[0] + message[1] + message[2] + message[3]) == "Dist"){
    message = message.split('Dist: ').join('');
    message = message.split('mm').join('');
    info_distancia.setAttribute('value', "" + message + "mm");
  }else{
  }
}

    </script>

  </body>
</html>
